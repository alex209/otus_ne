!
! Last configuration change at 20:22:11 MSK Sat Aug 16 2025
! NVRAM config last updated at 11:24:09 MSK Sun Aug 17 2025
!
version 15.4
service timestamps debug datetime msec
service timestamps log datetime msec
service password-encryption
!
hostname R14
!
boot-start-marker
boot-end-marker
!
!
enable secret 5 $1$Zcsy$0E4wkZzVrTIpLH5.Us.Xa1
!
no aaa new-model
clock timezone MSK 3 0
mmi polling-interval 60
no mmi auto-configure
no mmi pvc
mmi snmp-timeout 180
!
!
!
!
!
!
!
!


!
!
!
!
no ip domain lookup
ip domain name otus.ru
ip host R20CA 10.100.100.20
ip host r20ca.otus.ru 10.100.100.20
ip cef
ipv6 unicast-routing
ipv6 cef
!
multilink bundle-name authenticated
!
!
!
!
!
!
!
crypto pki trustpoint R20CA
 enrollment url http://r20ca.otus.ru:80
 serial-number
 subject-name CN=R14, O=Otus, C=RU
 revocation-check crl
!
!
crypto pki certificate chain R20CA
 certificate 02
  3082034D 30820235 A0030201 02020102 300D0609 2A864886 F70D0101 05050030
  2C310B30 09060355 04061302 5255310D 300B0603 55040A13 044F7475 73310E30
  0C060355 04031305 52323043 41301E17 0D323530 38313631 34333331 305A170D
  32363038 31363134 33333130 5A305731 0B300906 03550406 13025255 310D300B
  06035504 0A13044F 74757331 0C300A06 03550403 13035231 34312B30 0F060355
  04051308 36393233 34373032 30180609 2A864886 F70D0109 02160B52 31342E6F
  7475732E 72753082 0122300D 06092A86 4886F70D 01010105 00038201 0F003082
  010A0282 010100B6 6C66B72E F4152FED E39A8ECD 6B38E312 B76B9109 A24F67E0
  08511ACA B5FB6156 D851841A F93B5DDE C865B78C E3D473A5 316060C0 33CA638B
  496342A6 04572AA1 6E745A96 49EDBB1C F50586DF 9398F745 F3741C86 F9499B50
  B3870221 4D6CA5AF 61934745 D986ECF9 93BC267C 9688CBD4 FBBB04B4 44005D1B
  6B549281 2C9A1877 BA3D639E B2819C6F 9E85BC9D DA08911D 0CB2AC38 D6B1E822
  6053620F 363B6E65 9E9B9C2E FDEEFB76 2CAD3C88 7398AF8F C40DB737 5EB36F86
  02EE7DAF E58D32C1 22290A4D 02F9AF91 9D157E24 95749B41 52048005 5954691E
  2AF32B68 F6421A09 A1DB43B6 729226E3 17078C5C A8108B5E D8DED6E7 BB8F1FA3
  E585768A 60AEE302 03010001 A34F304D 300B0603 551D0F04 04030205 A0301F06
  03551D23 04183016 801419D5 5D9D13ED 99C17559 F48DD72B D2ADC096 D931301D
  0603551D 0E041604 14FAA19A 158B3C70 0AB56143 4A230BEF 5A30A762 64300D06
  092A8648 86F70D01 01050500 03820101 0039F26F D50B622F 0FAD6E8B 68535277
  934EDA25 7C947F77 B82F33FA 93C04F2A 4067593E E965A8A9 84ED91C0 0C423E35
  0E90B8F3 5B2D61E1 298AA8E4 50AB1352 CE5A3F7A DC553658 2E14AA7B AE97AC3C
  82F50926 DEBEF12E B86AA51F 37966E1F 26754F47 BA8A21CC A93FBA48 93771F5E
  B2D90FDC C1FAD46E 8E52B3B5 F1BC0B99 0D17B104 777C5734 17178B5A 0E883101
  6E353CD0 2170D228 C0DADAFC 6ABB074E 00F46A38 3A21AB0A F02D3CB0 FD51A104
  591065DB 97315F8F B2ACDB0D FD675AEF 67741103 78483574 925FD461 49F7C60B
  CC861181 AF935F67 166F7FE9 F85C488C 70EC2D7A 07565788 39D0E3AF 2534598E
  B5EE9D33 7C8162E7 6F89BAD3 08CCAC56 0F
        quit
 certificate ca 01
  30820336 3082021E A0030201 02020101 300D0609 2A864886 F70D0101 04050030
  2C310B30 09060355 04061302 5255310D 300B0603 55040A13 044F7475 73310E30
  0C060355 04031305 52323043 41301E17 0D323530 38313631 34323235 365A170D
  32383038 31353134 32323536 5A302C31 0B300906 03550406 13025255 310D300B
  06035504 0A13044F 74757331 0E300C06 03550403 13055232 30434130 82012230
  0D06092A 864886F7 0D010101 05000382 010F0030 82010A02 82010100 D7EC9C47
  B4CDE012 1F9ED2F7 4894F820 C2A315BD EEBD8AD7 08EFCDBF FBC4A4AF 3AB9459F
  3693EE25 66FDB71E 1AF8E147 919B9D80 B4AA048C 8A0A7271 F781D31E 74518E2F
  7B186864 D730F9D4 88DDBF0B BC55C0E4 44DBDD26 9A29FC29 EE29FA33 8AA042E5
  0F6228E9 CECB25D5 53BB1DF6 4C58FBEC 79610ABA 3EC962F7 70DFB9E8 6832781E
  E1B292F3 E37030E8 11100564 96DA11EA 194E4C4C 5926F1D6 490C947F E4CDC7E4
  95D054B7 1FE13A1E 1D91F8EF 9CD0250E 947AFB6A 160CE6EB B121DD61 F330753B
  72FB4CA6 0A7F5057 F4EB6670 6582E2EB 983AABC5 6757F038 7F03F277 8163B8F2
  D0A08D84 FD25BAF0 00362095 B5630E98 68C9B6D0 AA49568E 00258C41 02030100
  01A36330 61300F06 03551D13 0101FF04 05300301 01FF300E 0603551D 0F0101FF
  04040302 0186301F 0603551D 23041830 16801419 D55D9D13 ED99C175 59F48DD7
  2BD2ADC0 96D93130 1D060355 1D0E0416 041419D5 5D9D13ED 99C17559 F48DD72B
  D2ADC096 D931300D 06092A86 4886F70D 01010405 00038201 010011B9 09AAF655
  DEF00E1F 27D9DA1E 7EA7E97E AEAF5796 A7F8FF7A BF40CDAD 3FCA4265 25A1355B
  12CF8EA3 60DF6613 4B71A967 A4F9B687 44F9DF16 C1A2E0CA 5E0DA0DD 9437286A
  8693025D 5F05B9B5 2C853E28 116800BB 8EFB4BAA 2892CAC2 37FE2918 2D499EB8
  62F1D419 B5E92075 068F9936 15099A76 B2192E70 9DA1F51A 1B2AFAEC BE82E10C
  5F70C6D1 D350173B 6FF97B2E E6279507 89FB369A 9419C77F CAC7697F 8EB514AD
  0D259B25 1541750A 6D4C11CF CF183B25 F0E69D2C C9365BDE 052D0735 A7C1FDDE
  444252E6 DCDB5A9A FE178821 04E1FFFC EEC0A010 091E2421 B1635865 6C53438A
  1E59415D 78CE560F 30D2DA45 3D765477 1F1D3170 9F52DB75 8D5E
        quit
!
redundancy
!
!
!
!
!
!
!
crypto isakmp policy 10
 encr aes 256
 hash sha256
 group 16
 lifetime 3600
!
!
crypto ipsec transform-set ts_GRE esp-aes esp-sha-hmac
 mode transport
crypto ipsec transform-set ts_DMVPN esp-aes 256 esp-sha256-hmac
 mode transport
!
!
crypto ipsec profile pof_DMVPN
 set transform-set ts_DMVPN
!
crypto ipsec profile pof_GRE
 set transform-set ts_GRE
!
!
!
!
!
!
interface Loopback0
 description Loopback_R14
 ip address 10.100.100.14 255.255.255.255
 ipv6 address 2001:DB8::1001:14/128
 ipv6 enable
 ospfv3 1 ipv4 area 0
 ospfv3 1 ipv6 area 0
!
interface Tunnel0
 description to_SPB_R18_e0/2
 ip address 172.16.10.1 255.255.255.252
 tunnel source Ethernet0/2
 tunnel destination 67.73.193.2
 tunnel key 1
 tunnel protection ipsec profile pof_GRE
!
interface Tunnel10
 description DMVPN
 ip address 172.16.100.14 255.255.255.0
 no ip redirects
 ip nhrp map multicast dynamic
 ip nhrp network-id 100
 tunnel source Ethernet0/2
 tunnel mode gre multipoint
 tunnel key 100
 tunnel protection ipsec profile pof_DMVPN
!
interface Ethernet0/0
 description to_R12
 ip address 10.10.90.2 255.255.255.252
 ip nat inside
 ip virtual-reassembly in
 ipv6 address FE80::14 link-local
 ipv6 address 2001:DB8:1214::14/64
 ipv6 enable
 ospfv3 1 ipv4 area 10
 ospfv3 1 ipv6 area 10
!
interface Ethernet0/1
 description to_R13
 ip address 10.10.90.9 255.255.255.252
 ip nat inside
 ip virtual-reassembly in
 ipv6 address FE80::14 link-local
 ipv6 address 2001:DB8:1314::14/64
 ipv6 enable
 ospfv3 1 ipv4 area 10
 ospfv3 1 ipv6 area 10
!
interface Ethernet0/2
 description to_R22_AS101
 ip address 207.231.240.2 255.255.255.252
 ip nat outside
 ip virtual-reassembly in
 ipv6 address 2001:1860:4000:100::2/64
 ipv6 enable
!
interface Ethernet0/3
 description to_R19
 ip address 10.10.90.34 255.255.255.252
 ip nat inside
 ip virtual-reassembly in
 ipv6 address FE80::14 link-local
 ipv6 address 2001:DB8:1419::14/64
 ipv6 enable
 ospfv3 1 ipv4 area 101
 ospfv3 1 ipv6 area 101
!
interface Ethernet1/0
 description to_R15
 ip address 10.10.90.41 255.255.255.252
 ip nat inside
 ip virtual-reassembly in
 ipv6 address FE80::14 link-local
 ipv6 address 2001:DB8:1415::14/64
 ipv6 enable
 ospfv3 1 cost 60
 ospfv3 1 ipv4 area 0
 ospfv3 1 ipv6 area 0
!
interface Ethernet1/1
 no ip address
 shutdown
!
interface Ethernet1/2
 no ip address
 shutdown
!
interface Ethernet1/3
 no ip address
 shutdown
!
router ospfv3 1
 router-id 10.100.100.14
 area 101 stub no-summary
 area 10 stub
 !
 address-family ipv4 unicast
  passive-interface Loopback0
 exit-address-family
 !
 address-family ipv6 unicast
  passive-interface Loopback0
 exit-address-family
!
router bgp 1001
 bgp router-id 10.100.100.14
 bgp log-neighbor-changes
 bgp listen range 172.16.100.0/24 peer-group REM_OFFICE
 neighbor REM_OFFICE peer-group
 neighbor REM_OFFICE remote-as 65027 alternate-as 65028
 neighbor 10.10.90.42 remote-as 1001
 neighbor 2001:DB8:1415::15 remote-as 1001
 neighbor 2001:1860:4000:100::1 remote-as 101
 neighbor 172.16.10.2 remote-as 2042
 neighbor 207.231.240.1 remote-as 101
 !
 address-family ipv4
  network 10.10.90.40 mask 255.255.255.252
  network 207.231.240.0 mask 255.255.255.252
  redistribute ospfv3 1 route-map rm_for_VPN
  neighbor REM_OFFICE activate
  neighbor REM_OFFICE route-map rm_REM_OFFICE out
  neighbor 10.10.90.42 activate
  no neighbor 2001:DB8:1415::15 activate
  no neighbor 2001:1860:4000:100::1 activate
  neighbor 172.16.10.2 activate
  neighbor 172.16.10.2 route-map rm_REM_OFFICE out
  neighbor 207.231.240.1 activate
  neighbor 207.231.240.1 prefix-list pl_RFC_1918 out
  neighbor 207.231.240.1 filter-list 1 out
 exit-address-family
 !
 address-family ipv6
  network 2001:DB8:1415::/64
  network 2001:1860:4000:100::/64
  neighbor 2001:DB8:1415::15 activate
  neighbor 2001:1860:4000:100::1 activate
  neighbor 2001:1860:4000:100::1 filter-list 1 out
 exit-address-family
!
ip forward-protocol nd
!
ip as-path access-list 1 permit ^$
!
no ip http server
no ip http secure-server
ip nat inside source list 101 interface Ethernet0/2 overload
ip nat inside source static tcp 10.100.100.19 22 207.231.240.2 22 extendable
!
!
ip prefix-list for_VPN seq 10 permit 192.168.10.0/24
ip prefix-list for_VPN seq 20 permit 192.168.20.0/24
ip prefix-list for_VPN seq 30 permit 10.100.100.0/24 le 32
!
ip prefix-list pl_REM_OFFICE seq 5 permit 192.168.12.0/24
ip prefix-list pl_REM_OFFICE seq 20 permit 192.168.22.0/24
ip prefix-list pl_REM_OFFICE seq 30 permit 10.200.200.0/24 le 32
!
ip prefix-list pl_RFC_1918 seq 10 deny 10.0.0.0/8 le 32
ip prefix-list pl_RFC_1918 seq 20 deny 172.16.0.0/12 le 32
ip prefix-list pl_RFC_1918 seq 30 deny 192.168.0.0/16 le 32
ip prefix-list pl_RFC_1918 seq 40 permit 0.0.0.0/0 le 32
!
ip prefix-list pl_SBP seq 10 permit 192.168.11.0/24
ip prefix-list pl_SBP seq 20 permit 192.168.21.0/24
ip prefix-list pl_SBP seq 30 permit 10.200.100.0/24 le 32
!
route-map rm_for_VPN permit 10
 match ip address prefix-list for_VPN
!
route-map rm_REM_OFFICE permit 10
 match ip address prefix-list pl_REM_OFFICE for_VPN pl_SBP
!
!
access-list 101 permit ip 192.168.10.0 0.0.0.255 any
access-list 101 permit ip 192.168.20.0 0.0.0.255 any
access-list 101 permit ip 10.100.100.0 0.0.0.255 any
access-list 101 permit ip 10.10.90.0 0.0.0.255 any
!
control-plane
!
!
!
!
!
!
!
banner motd ^CUnauthorized access denied^C
!
line con 0
 password 7 13061E010803
 logging synchronous
 login
line aux 0
line vty 0 4
 password 7 0822455D0A16
 login
 transport input none
!
ntp update-calendar
ntp server 10.100.100.12
ntp server 10.100.100.13
!
end
